--- Log opened Tue Nov 19 00:00:18 2013
04:19 < hufg:#liferay> anyone ever wondered how massive a theme can be? 8)
04:20 < hufg:#liferay> maan there is a lot of code in the theme
04:22 < hufg:#liferay> ehh this theme i meant
04:41 < Tar-Minyatur:#liferay> Our theme loads 40 JS files on every page.
04:41 < Tar-Minyatur:#liferay> Tell me about massive.
04:42 < Tar-Minyatur:#liferay> They were to dumb to do it properly and now there is all JS code embedded in the theme...and the different JS files use indexOf('some-url-snippet') to check if they should be run on the current page. So sad.
04:47 < hufg:#liferay> Tar-Minyatur: hehe
04:48 < hufg:#liferay> Tar-Minyatur: we use requirejs for that
04:48 < hufg:#liferay> a few problems still exists but it's the right choice
04:48 < Tar-Minyatur:#liferay> The problem is that refactoring this mess will be very difficult and time-consuming.
04:49 < hufg:#liferay> 8)
04:49 < hufg:#liferay> yeah it would have some work load
04:50 < Tar-Minyatur:#liferay> Mhm. One of my frontend devs is complaining that CSS hotdeployment doesn't work.
04:51 < Tar-Minyatur:#liferay> Is there an easy way to check if he disabled the CSS fast load stuff correctly?
04:52 < hufg:#liferay> mm just see portal-ext.props
04:52 < Tar-Minyatur:#liferay> I think he added -Dexternal-properties=portal-developer.properties to his Tomcat run configuration.
04:52 < Tar-Minyatur:#liferay> This should pretty much disable all caching, shouldn't it?
04:55 < hufg:#liferay> mm
04:55 < hufg:#liferay> no idea
04:55 < Tar-Minyatur:#liferay> The file is correctly deployed...I can access it directly and see the change. But apparently the process behind this main.css stuff didn't recognize this change.
04:55 < Tar-Minyatur:#liferay> I thought it should be deactivated when I shut off all this caching stuff. -.-
05:07 < Tar-Minyatur:#liferay> Sometimes I think it would be cheaper to give all content editors HTML training and work with static pages only...
05:26 < Tar-Minyatur:#liferay> Mhm. I get a 404 for /html/themes/control_panel/css/compass, because it tries to retrieve that from our CDN.
05:27 < Tar-Minyatur:#liferay> I would assume that this is some kind of CSS magic that does some optimization or something...and this definitely shouldn't be retrieved from the CDN...
05:31 < Tar-Minyatur:#liferay> topolik: Hi there. I remember reading some CSS related things in your blog. Do you know your way around Liferay's CSS stuff?
05:32 < topolik:#liferay> Tar-Minyatur: Hi, well, CSS basics :)
05:32 < topolik:#liferay> how can I help?
05:33 < topolik:#liferay> I see, the previous conversation, right?
05:36 < topolik:#liferay> so when you directly hit the http://portal/xxx-portlet/css/main.css the changes are there, right?
05:36 < topolik:#liferay> but they are not visible on the page
05:36 < topolik:#liferay> can you verify how is the CSS file linked from the page?
05:37 < topolik:#liferay> it should be something like http://portal/xxx-portlet/main.css?browserId=...&themeId=...t=...
05:38 < topolik:#liferay> can you display that file in your browser and try force refresh? i.e. CTRL+F5?
05:45 < Tar-Minyatur:#liferay> When I access the main.css?browser... directly, I get a bunch of import statements.
05:46 < topolik:#liferay> and what you get without the query string, the same?
05:47 < Tar-Minyatur:#liferay> The same but with some empty lines between the imports.
05:47 < Tar-Minyatur:#liferay> There is also another link to a main.css, which provides much more CSS.
05:47 < topolik:#liferay> hmm
05:47 < Tar-Minyatur:#liferay> The first is /html/css/main.css?browser....
05:47 < Tar-Minyatur:#liferay> The second is from the Theme.
05:48 < topolik:#liferay> ah, right, one is portal default styles
05:48 < Tar-Minyatur:#liferay> http://liferay.local/my-theme/css/main.css?browser...
05:49 < Tar-Minyatur:#liferay> I can't find my change in the latter.
05:49 < Tar-Minyatur:#liferay> But if I directly call the CSS file from the theem folder, the change is there.
05:50 < topolik:#liferay> hmm
05:51 < topolik:#liferay> which css file is it?
05:51 < topolik:#liferay> the one imported?
05:51 < topolik:#liferay> from main.css?
05:53 < Tar-Minyatur:#liferay> I have no clue how main.css works.
05:54 < Tar-Minyatur:#liferay> We have an override.css in our theme.
05:54 < Tar-Minyatur:#liferay> I can't find that anywhere in the page, so I guess it's included somewhere.
05:54 < topolik:#liferay> yeah
05:54 < topolik:#liferay> it should be included from main.css
05:55 < topolik:#liferay> probably you know that themes CSS should be overridden using custom.css file
05:55 < topolik:#liferay> themes work on inheritance
05:55 < Tar-Minyatur:#liferay> Our theme is not built from a Liferay theme. :-(
05:55 < topolik:#liferay> oh
05:55 < Tar-Minyatur:#liferay> I have no clue how built this mess like this.
05:55 < topolik:#liferay> you didn't use Plugins SDK?
05:55 < Tar-Minyatur:#liferay> They took a ready HTML layout and "Liferayified" it.
05:55 < topolik:#liferay> aaah
05:56 < topolik:#liferay> uhm
05:56 < Tar-Minyatur:#liferay> We don't use plugins SDK. All our plugins are Maven projects.
05:56 < topolik:#liferay> n/p, there is also maven plugins sdk
05:56 < topolik:#liferay> but I'm not sure if you use it
05:56 < topolik:#liferay> ok, so
05:56 < topolik:#liferay> question
05:57 < topolik:#liferay> is override.css  referenced from main.css using the import statement?
05:57 < Tar-Minyatur:#liferay> Not in one of the two main.css references I found in the page.
05:58 < Tar-Minyatur:#liferay> I couldn't find any mention of override.css in either of them.
05:58 < topolik:#liferay> it should be in the http://liferay.local/my-theme/css/main.css file
05:59 < topolik:#liferay> I'm afraid that if it's not referenced then it cannot be loaded
06:00 < topolik:#liferay> can you search through your theme sources if override.css is mentioned anywhere?
06:00 < Tar-Minyatur:#liferay> I'm fairly sure that it is loaded.
06:01 < topolik:#liferay> ok, we need to find how it is loaded
06:01 < topolik:#liferay> from where it's referenced
06:01 < Tar-Minyatur:#liferay> Mhm.
06:01 < Tar-Minyatur:#liferay> ./main/webapp/css/main.css:33:@import url(override.css);
06:01 < topolik:#liferay> it's also possible that it's referenced directly from theme velocity templates like portal_normal.vm or so
06:01 < topolik:#liferay> ok
06:02 < Tar-Minyatur:#liferay> When I go to /mytheme/css/main.css I can't find it in there.
06:02 < topolik:#liferay> is it deployed?
06:02 < Tar-Minyatur:#liferay> Yes. I merely added one directive to the override.css and wanted it to be hotdeployed.
06:03 < Tar-Minyatur:#liferay> When I directly access the override.css I can see the new directive.
06:07 < Tar-Minyatur:#liferay> Looks to me like there is some kind of assembly task done that merges the CSS files?
06:07 < Tar-Minyatur:#liferay> And this isn't triggered again when I only hotdeploy a single CSS file?
06:08 < topolik:#liferay> depends
06:08 < topolik:#liferay> there is sort of caching
06:08 < Tar-Minyatur:#liferay> I'm fairly sure I deactivated the caching for everything I could find.
06:08 < topolik:#liferay> ok
06:09 < topolik:#liferay> what does this mean "/mytheme/css/main.css"?
06:09 < topolik:#liferay> that the import statement is deployed on server?
06:09 < topolik:#liferay> I meant: "When I go to /mytheme/css/main.css I can't find it in there."
06:09 < Tar-Minyatur:#liferay> The VM template of the theme seems to link to that file.
06:10 < Tar-Minyatur:#liferay> I found that in the sourcecode of the portal as it is delivered by Liferay.
06:10 < Tar-Minyatur:#liferay> There are three different links to a main.css...one of them to the one in the theme.
06:10 < topolik:#liferay> ok, still, I have the question
06:10 < topolik:#liferay> the theme/css/main.css file on the server
06:11 < topolik:#liferay> does it contain the @import url(override.css); ?
06:11 < topolik:#liferay> here I mean the file on file system, not what you get by HTTP request
06:12 < Tar-Minyatur:#liferay> No. It looks like the override.css has been merged into the main.css
06:12 < Tar-Minyatur:#liferay> Oh. On the file system. Mom.
06:13 < Tar-Minyatur:#liferay> Doesn't look like it's in there.
06:13 < Tar-Minyatur:#liferay> So the merging is done at build time?
06:14 < Tar-Minyatur:#liferay> In my theme soucecode I see only import statements in main.css. In the theme deployed on the server the main.css is huge and contains no more import statements.
06:20 < topolik:#liferay> ok
06:20 < topolik:#liferay> so it's the deployment process that merges the files together
06:20 < topolik:#liferay> this way the CSS hot-deploy cannot work
06:20 < Tar-Minyatur:#liferay> Looks like it...yes. Is that something Liferay does or has one of our guys implemented this?
06:21 < topolik:#liferay> nope
06:21 < topolik:#liferay> AFAIK portal doesn't touch the original CSS files
06:21 < topolik:#liferay> it merges them but put the merged result into temp folder
06:23 < Tar-Minyatur:#liferay> Okay. So I have to track down the guy how built out Maven project...
06:23 < Tar-Minyatur:#liferay> Thanks!
06:24 < Tar-Minyatur:#liferay> I have another issue, if you can spare some more time. Our dev system reports a 404 on /html//html/themes/control_panel/css/compass
06:24 < Tar-Minyatur:#liferay> Uh. Sorry. /html/themes/control_panel/css/compass
06:24 < Tar-Minyatur:#liferay> And I vaguely recall that compass is some CSS magic util.
06:24 < Tar-Minyatur:#liferay> So it's probably wrong that the portal tries to retrieve this from the CDN, right?
06:32 < topolik:#liferay> uhm
06:32 < topolik:#liferay> I don't understand it
06:33 < topolik:#liferay> I can't find comass directory there
06:33 < topolik:#liferay> *compass
06:33 < Tar-Minyatur:#liferay> Okay. More context: We are using a CDN (S3 bucket).
06:33 < topolik:#liferay> uhm, I see - https://github.com/liferay/liferay-portal/blob/6.1.1-ga2/portal-web/docroot/html/themes/control_panel/_diffs/css/custom.css
06:33 < Tar-Minyatur:#liferay> Liferay is configured to use this CDN.
06:33 < topolik:#liferay> first line
06:33 < topolik:#liferay> there is @import "compass";
06:33 < Tar-Minyatur:#liferay> Yeah.
06:34 < topolik:#liferay> but I believe this should be processed by Liferay on the CDN server
06:34 < topolik:#liferay> and not returned in the output
06:34 < Tar-Minyatur:#liferay> Probably.
06:34 < Tar-Minyatur:#liferay> Looks like the wrong files were uploaded to the CDN.
06:34 < topolik:#liferay> uhm
06:34 < Tar-Minyatur:#liferay> Because the entire CP looks broken.
06:34 < topolik:#liferay> does your CDN run the portat
06:34 < topolik:#liferay> portal
06:35 < Tar-Minyatur:#liferay> No. As I said...it's only an S3 bucket.
06:35 < topolik:#liferay> aah, got it
06:35 < topolik:#liferay> so there are only the CSS files
06:35 < Tar-Minyatur:#liferay> We actually have the entire theme deployed there.
06:35 < Tar-Minyatur:#liferay> I think they just extracted the theme war file there...
06:35 < topolik:#liferay> got it
06:36 < Tar-Minyatur:#liferay> And they also uploaded some Liferay assets.
06:36 < topolik:#liferay> I never created a CDN but I believe there should be the result CSS files, not the source ones
06:36 < Tar-Minyatur:#liferay> Because Liferay prepends everything with the CDN host when the feature is activated.
06:36 < topolik:#liferay> look at this: https://github.com/liferay/liferay-portal/blob/6.1.1-ga2/portal-web/docroot/html/themes/control_panel/_diffs/css/custom.css#L151,L160
06:37 < topolik:#liferay> this is clearly not a css file
06:37 < topolik:#liferay> but SASS or something like this
06:38 < topolik:#liferay> so it seems the file cannot be used as-is
06:38 < topolik:#liferay> but requires pre-processing
06:39 < daqSam:#liferay> Hello fellas! Does anyone here know how to inhibit sitemap.xml from having localization entries (http://mysite.url/page/pt, http://mysite.url/page/uk) when my site is English only? Tks
06:40 < Tar-Minyatur:#liferay> topolik: Okay. So I have to review which files have been deployed and probably change the process. Thanks.
06:41 < topolik:#liferay> Tar-Minyatur: y/w
06:42 < topolik:#liferay> daqSam: which portal version do you use?
06:50 < daqSam:#liferay> LR 6.1.2
07:00 < topolik:#liferay> https://github.com/liferay/liferay-portal/blob/6.1.2-ga3/portal-impl/src/com/liferay/portlet/layoutsadmin/util/SitemapImpl.java#L251
07:00 < topolik:#liferay> so it prints the sitemap using all available locales
07:02 < daqSam:#liferay> @topolik: Liferay Portal Enterprise Edition 6.1.20 EE (Paton / Build 6120 / July 31, 2012)
07:02 < topolik:#liferay> ah
07:02 < topolik:#liferay> ok
07:03 < daqSam:#liferay> The problem with this for us is that our portal is multilingual
07:03 < daqSam:#liferay> but one specific site isn't
07:03 < topolik:#liferay> uhm
07:03 < daqSam:#liferay> and the localized sitemap is affection SEO
07:03 < topolik:#liferay> I understand
07:03 < daqSam:#liferay> *affecting even
07:03 < topolik:#liferay> this is implemented in 6.2
07:04 < daqSam:#liferay> is it? how is it dealt with in 6.2?
07:04 < topolik:#liferay> per-site settings
07:04 < topolik:#liferay> https://github.com/topolik/liferay-portal/commit/88707c9b0bf8c91a20de457fde8074a75f4bf936
07:05 < topolik:#liferay> it's this feature: https://issues.liferay.com/browse/LPS-37886
07:06 < daqSam:#liferay> i see... cool
07:06 < daqSam:#liferay> thanks for the info
07:07 < daqSam:#liferay> do u know of any workaround this for 6.1.2? Like some sort of hook or something?
07:07 < topolik:#liferay> hmm, yes
07:07 < topolik:#liferay> you can write a servlet filter in the hook
07:08 < topolik:#liferay> that would remove all the unnecessary entries from XML
07:08 < daqSam:#liferay> I see... and that could be made site specific instead of portal wide? (sorry, not much exp in that area)
