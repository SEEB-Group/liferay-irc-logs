--- Log opened Fri Apr 25 00:00:46 2014
03:57 < twen> 'morning
04:05 < modd> hi
06:13 < sm`> hello
06:14 < sm`> does anyone have any resource for creating JSONWebService without using Service Builder
06:14 < sm`> http://www.liferay.com/community/forums/-/message_boards/message/36741036
06:14 < sm`> i got stuck with using ServiceBuilder cuz the generated stuff (spring conf topolik suggested) is colliding with my custom
06:14 < sm`> spring configuration
06:15 < sm`> my spring+hibernate configuratioN*
06:15 < topolik> sm`: Hi, I thought about it and there is no other exception in spring registration, right?
06:16 < sm`> no just those 2
06:16 < sm`> however i noticed another thing
06:16 < sm`> i have <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class> in my web.xml
06:17 < sm`> i found some suggestions on the forum
06:17 < sm`> to use <listener-class>com.liferay.portal.kernel.spring.context.PortletContextLoaderListener</listener-class>
06:18 < topolik> the PortletContextLoaderListener should be added during auto deploy
06:18 < sm`> but when i do this, my portlet is not working ie my appcontext is not loaded corectly
06:20 < topolik> PortletContextLoaderListener is responsible to init the spring context
06:20 < topolik> but it inits the context from the service builder files
06:20 < topolik> on the other hand, ContextLoaderListener should initialize from your app XML
06:20 < topolik> so I guess there is a conflict in the initialization
06:21 < topolik> (there can be only one root spring context)
06:21 < sm`> i moved my spring conf in ext-spring.xml
06:21 < sm`> and it loads fine from there too
06:21 < sm`> the portlet is working fine
06:21 < sm`> but the jsonws still throws the same exception
06:21 < topolik> and you kept the ContextLoaderListener in web.xml?
06:22 < sm`> nope removed it
06:22 < topolik> ok
06:22 < sm`> i thought the service builder will load it
06:22 < sm`> and it did
06:22 < topolik> ok
06:22 < sm`> but there is still some other problem
06:23 < sm`> thats why i thought that maybe i should go and do everything manually
06:23 < sm`> create my own Service and ServiceImpl @JSONWebService classes
06:25 < topolik> uhm, it should work OOTB
06:26 < topolik> and you still get the same exception - that bean locator is not set?
06:27 < topolik> because now it should be set when ServiceBuilder is initialized (at least with our beans)
06:27 < topolik> *our = your :D
06:27 < sm``> yes
06:27 < sm``> {"exception":"com.liferay.portal.kernel.bean.BeanLocatorException: BeanLocator has not been set for servlet context StoreFinder-portlet"}
06:28 < sm``> and also INFO   | jvm 1    | 2014/04/25 11:43:26 | SEVERE: ClassNotFoundException while loading persisted sessions: java.lang.ClassNotFoundException: com.liferay.portal.model.impl.UserImpl
06:28 < sm``> on restart
06:29 < topolik> hmm, ok, let's try to solve this one, just in case it has something in common
06:30 < topolik> I think tomcat is saving existing sessions into some files somewhere so that they persist restarts
06:31 < topolik> yeah, SESSIONS.ser - https://tomcat.apache.org/tomcat-7.0-doc/config/manager.html
06:31 < topolik> is it possible for you to delete the file?
06:31 < sm`> yes
06:31 < sm`> at least on the developent server
06:39 < sm`> find . -name 'SESSIONS.ser'
06:39 < sm`> ./tomcat-7.0.27.mac/work/Catalina/localhost/StoreFinder-portlet/SESSIONS.ser
06:40 < sm`> let me remove that one
06:40 < sm`> and start the tomcat again
06:42 < sm`> that fixed the exceptions on statup
06:42 < sm`> u were right
06:42 < sm`> tnx
06:43 < sm`> but the problem with the jsonws is still there
06:43 < sm`> damn.
06:44 < topolik> ok, at least we know it's not related :)
06:45 < sm`> haha
06:45 < sm`> true
06:47 < topolik> can you please share content of the service.properties, all the spring config files and deployed web.xml (the rewritten one)?
06:49 < sm`> web.xml, the one after deployment or my latest?
06:52 < sm`> nvm
06:52 < sm`> let me pastebin
06:53 < sm`> service.properties, ext-spring.xml, web.xml - http://pastebin.com/jgZQUrsM
06:53 < sm`> shall i pastebin the other generated by service builder such as base-spring, cluster-spring, hibernate-spring etc. ?
06:55 < modd> will journalarticlelocalserviceutil.getarticlebyresourceprimkey always return the list sorted by version desc? I can't find the service.xml for this service
06:57 < topolik> sm`: I see you still have org.springframework.web.context.ContextLoaderListener in the web.xml
06:57 < topolik> and yes, I meant the one inside tomcat, after deployment
07:02 < sm`> yes i do... shall i remove it?
07:04 < sm`> let me try that and then paste the deployed web.xml
07:09 < sm`> how the @JSONWebService
07:09 < sm`> is not scanned
07:10 < sm`> the webserivces are not listed on /StoreFinder-portlet/api/jsonws
07:10 < sm`> after i removed the ContextLoaderListener
07:12 < sm`> and heres the deployed web.xml
07:12 < sm`> http://pastebin.com/z4BzkGiL
07:12 < sm`> and im officially lost ;]
07:55 < twen> Hello.. I'm discovering Liferay, as we will use it in the next month in prod
07:56 < twen> I'm wondering: I created a private site. and added 2 public pages. Are these pages viewable to non members ? or should I put these page to private... in this private site ?
08:00 < GevatterJan> Hey twen.  idea of Private and Publc scope is:
08:00 < GevatterJan> Private is only accessible by members of the group.
08:00 < GevatterJan> Public is available to everyone.
08:01 < sm`> topolik, any idea how my portlets dont initialize with com.liferay.portal.kernel.spring.context.PortletContextLoaderListener
08:01 < GevatterJan> If you want to change that behavior you modify the Permissions on that paes
08:01 < sm`> and they work fine with org.springframework.web.context.ContextLoaderListener
08:06 < twen> GevatterJan Thanks for the input. I think I mixed a little bit 2 things :p
08:07 < twen> in a private site, public pages are viewable to anyone. bt to see private pages, non members needs to be "subscribed" by the site admin. Right ?
08:10 < modd> you don't need to be a member of a site to see the public site but you have to be a member to see the private site
08:10 < topolik> sm`: good progress! so with ContextLoaderListener everything works fine, except calling the services. With PortletContextLoaderListener the portlet is not initialized
08:10 < modd> the pages in these sites have own restrictions
08:10 < sm`> topolik, yes and i cant understand why
08:11 < sm`> because
08:11 < sm`> public class PortletContextLoaderListener extends org.springframework.web.context.ContextLoaderListener
08:11 < sm`> http://docs.liferay.com/portal/6.1/javadocs-all/com/liferay/portal/spring/context/PortletContextLoaderListener.html
08:11 < modd> e.g. you can give guests view permissions on a page of a private site but a non-registred user can't access this page because he's not a member of the site
08:11 < modd> so private/pubic sites is only about member or not
08:12 < modd> while pages will work with the other roles and permissions of liferay
08:17 < topolik> sm`: ok, try to use PortletContextLoaderListener instead of Spring's ContextLoaderListener. What exception do you get?
08:18 < topolik> looking at https://github.com/liferay/liferay-portal/blob/6.1.2-ga3/portal-impl/src/com/liferay/portal/spring/context/PortletContextLoaderListener.java, it initializes the Spring context using the ContextLoaderListener + adds other things, like the BeanLocator we need
08:18 < topolik> and reads spring config using the listener init parameter "portalContextConfigLocation" in web.xml
08:19 < topolik> ah, no, it's servlet context init parameter
08:20 < topolik> and, uhm - https://github.com/liferay/liferay-portal/blob/6.1.2-ga3/portal-impl/src/com/liferay/portal/spring/context/PortalApplicationContext.java
08:20 < GevatterJan> <context-param>
08:20 < GevatterJan> 		<param-name>contextConfigLocation</param-name>
08:20 < GevatterJan> 		<param-value>classpath*:/META-INF/applicationContext.xml</param-value>
08:20 < sm`> topolik, when i use PortletContextLoaderListener my portlets doesnt initialize
08:20 < GevatterJan> 	</context-param>
08:20 < sm`> nothing workzz
08:20 < GevatterJan> 	<listener>
08:20 < GevatterJan> 		<listener-class>com.liferay.portal.kernel.spring.context.PortletContextLoaderListener</listener-class>
08:20 < GevatterJan> 	</listener>
08:20 < GevatterJan> 	<listener>
08:20 < GevatterJan> 		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
08:20 < GevatterJan> 	</listener>
08:20 < GevatterJan> 	<listener>
08:20 < GevatterJan> 		<listener-class>org.springframework.web.context.request.RequestContextListener</listener-class>
08:20 < GevatterJan> 	</listener>
08:20 < GevatterJan> 	
08:20 < GevatterJan>    <context-param>
08:20 < GevatterJan> 		<param-name>portalContextConfigLocation</param-name>
08:20 < GevatterJan> 		<param-value>/WEB-INF/context/common.xml</param-value>
08:20 < GevatterJan>   </context-param>
08:20 < GevatterJan>   	<servlet>
08:20 < GevatterJan>     	<servlet-name>ViewRendererServlet</servlet-name>
08:20 < GevatterJan>     	<servlet-class>org.springframework.web.servlet.ViewRendererServlet</servlet-class>
08:20 < GevatterJan>     	<load-on-startup>1</load-on-startup>
08:20 < GevatterJan>   	</servlet>	 	
08:20 < GevatterJan> 	<servlet>
08:20 < GevatterJan> 		<servlet-name>JSON Web Service Servlet</servlet-name>
08:21 < GevatterJan> 		<servlet-class>com.liferay.portal.kernel.servlet.PortalClassLoaderServlet</servlet-class>
08:21 < GevatterJan> 		<init-param>
08:21 < GevatterJan> 		<param-name>servlet-class</param-name>
08:21 < GevatterJan> 		<param-value>com.liferay.portal.servlet.JSONServlet</param-value>
08:21 < GevatterJan> 		</init-param>
08:21 < GevatterJan> 		<load-on-startup>0</load-on-startup>
08:21 < GevatterJan> 	</servlet>
08:21 < GevatterJan> 	<servlet-mapping>
08:21 < GevatterJan> 		<servlet-name>JSON Web Service Servlet</servlet-name>
08:21 < GevatterJan> 		<url-pattern>/api/jsonws/*</url-pattern>
08:21 < GevatterJan> 	</servlet-mapping>
08:21 < GevatterJan> 	<servlet-mapping>
08:21 < GevatterJan> 		<servlet-name>JSON Web Service Servlet</servlet-name>
08:21 < GevatterJan> 		<url-pattern>/api/secure/jsonws/*</url-pattern>
08:21 < GevatterJan> 	</servlet-mapping>	
08:21 < GevatterJan>   	<servlet-mapping>
08:21 < GevatterJan>     	<servlet-name>ViewRendererServlet</servlet-name>
08:21 < GevatterJan>     	<url-pattern>/WEB-INF/servlet/view</url-pattern>
08:21 < GevatterJan>   	</servlet-mapping>
08:21 < GevatterJan>   	<servlet>
08:21 < GevatterJan> 	    <servlet-name>webservices</servlet-name>
08:21 < GevatterJan> 	    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
08:22 < GevatterJan>     	<load-on-startup>1</load-on-startup>
08:22 < GevatterJan>   	</servlet>
08:22 < GevatterJan>   	<servlet-mapping>
08:22 < GevatterJan> 	    <servlet-name>webservices</servlet-name>
08:22 < GevatterJan>     	<url-pattern>/service/*</url-pattern>
08:22 < GevatterJan>   	</servlet-mapping>
08:22 < GevatterJan> I do add all these things to get it working properly...
08:22 < topolik> oh, great!
08:23 < sm`> GevatterJan, can you please pastebin, im using mIRC :)
08:24 < GevatterJan> http://pastebin.com/ftj5dfmC
08:25 < sm`> tnx
08:25 < topolik> if it works, we should save it for future generations! :)
08:26 < twen> I'm surprise this channel has no flood conreol :-O
08:26 < twen> control
08:27 < sm`> i bet i t does
08:27 < sm`> but the threshold is higher ;]
08:32 < sm`> fuck me
08:32 < sm`> i added the 3 listeners
08:32 < sm`> <listener>
08:32 < sm`>              <listener-class>com.liferay.portal.kernel.spring.context.PortletContextLoaderListener</listener-class>
08:32 < sm`>      </listener>
08:32 < sm`>      <listener>
08:32 < sm`>              <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
08:32 < sm`>      </listener>
08:32 < sm`>      <listener>
08:32 < sm`>              <listener-class>org.springframework.web.context.request.RequestContextListener</listener-class>
08:32 < sm`>      </listener>
08:33 < sm`> and still the sam exception on the webservice
08:43 < GevatterJan> YOU WANT TO WRITE A WEBSERVICE ON YOUR OWN WITH SPRING CONTROLLERS?
08:43 < GevatterJan> Uupsi. Sry 4 caps
08:44 < jardineworks> lol
08:44 < sm`> :D
08:44 < jardineworks> i proposed to my wife on National Caps Locks Day.
08:44 < jardineworks> I had tshirts made ... "eRIN wILL yOU mARRY mE?"
08:44 < sm`> i have portlets with my own spring + hibernte configuration
